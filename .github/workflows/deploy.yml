name: Deploy with CI and CD

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    uses: ./.github/workflows/build.yml
  analyse:
    uses: ./.github/workflows/analyse.yml
    needs: [build]
  docker-build:
    uses: ./.github/workflows/docker-build.yml
    needs: [analyse]
  notify:
    runs-on: ubuntu-latest
    needs: [docker-build]
    steps:
      - name: Notify success
        run: echo "Deployment pipeline completed successfully!"
  clean:
    runs-on: ubuntu-latest
    needs: [docker-build]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Clean up Docker images
        run: |
          IMAGES=$(docker images -q)
          if [ -n "$IMAGES" ]; then
            docker rmi $IMAGES
          else
            echo "No Docker images to remove"
          fi